package exploiter.controller;

import AgameMain.Main;
import exploiter.Exploiter;
import exploiter.service.InsertService;
import exploiter.service.ResearchByIdService;

public class InsertController implements Controller {
	InsertService service = new InsertService();
	ResearchByIdService byIdService = new ResearchByIdService();

	public void process() {
		String id = null;
		int admin=0;

		System.out.println("회원가입을 시작합니다. ");

		System.out.println("↓↓회원가입↓↓");
		System.out.print("아이디를 입력하세요. ->");
		id = check_Id(id);
		System.out.print("비밀번호를 입력하세요. ->");
		String password = Main.sc.nextLine();
		System.out.print("닉네임을 이용하세요. ->");
		String nickname = Main.sc.nextLine();
		System.out.print("일반 회원인 경우 숫자 0을, 관리자인 경우 숫자 1을 입력하세요. ");
		
		// 관리자 체크-수정중
		try {
			admin = Integer.parseInt(Main.sc.nextLine());
			
			if(!(admin==0 || admin==1)) {
				throw new Exception();
			}
			
		}catch (Exception e) {
			System.out.println("0이나 1만 입력 가능합니다.");
		}
		
		// 회원가입 여부 확인
		int result = service.insert(new Exploiter(id, password, nickname, admin));

		if (result > 0) {
			System.out.println("회원가입이 완료되었습니다.");
		} else {
			System.out.println("회원가입에 실패하였습니다. 메인 화면으로 돌아갑니다. ");
		}
	}

	// 아이디 중복체크
	private String check_Id(String id) {
		while (true) {
			id = Main.sc.nextLine();
			if ((byIdService.researchById(id) == null)) {
				return id;
			}
			System.out.println("아이디가 중복되었습니다. 다시 입력하세요");
		}

	}

}
